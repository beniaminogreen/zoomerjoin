<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="zoomerjoin">
<title>Matching Vectors Based on Euclidean Distance â€¢ zoomerjoin</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Matching Vectors Based on Euclidean Distance">
<meta property="og:description" content="zoomerjoin">
<meta property="og:image" content="https://beniaminogreen.github.io/zoomerjoin/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">zoomerjoin</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/benchmarks.html">Benchmarks</a>
    <a class="dropdown-item" href="../articles/guided_tour.html">A Zoomerjoin Guided Tour</a>
    <a class="dropdown-item" href="../articles/matching_vectors.html">Matching Vectors Based on Euclidean Distance</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/beniaminogreen/zoomerjoin/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Matching Vectors Based on Euclidean Distance</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/beniaminogreen/zoomerjoin/blob/HEAD/vignettes/matching_vectors.Rmd" class="external-link"><code>vignettes/matching_vectors.Rmd</code></a></small>
      <div class="d-none name"><code>matching_vectors.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://beniaminogreen.github.io/zoomerjoin/">zoomerjoin</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The flagship feature of zoomerjoin is are the tidy joins for strings
using the Jaccard distance, but zoomerjoin also allows you to join
vectors using Euclidean distance. This can be useful for joining
addresses or coordinates in space.</p>
<p>Unlike other nearest-neighbor methods such as KD-trees, the joins do
not slow down as the dimension of the coordinates increases, so
zoomerjoin can be used can be used to find close points in a
high-dimensional space (such as word embeddings).</p>
</div>
<div class="section level2">
<h2 id="demonstration">Demonstration<a class="anchor" aria-label="anchor" href="#demonstration"></a>
</h2>
<p>For this demonstration, I create a simulated dataset of 10^5 points
distributed uniformly within a 100-dimensional hypercube. I join this to
another dataset which is a copy of the first with each point shifted an
tiny random amount.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">10</span><span class="op">^</span><span class="fl">5</span> <span class="co"># number of data points</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fl">10</span><span class="op">^</span><span class="fl">2</span> <span class="co"># dimension</span></span>
<span></span>
<span><span class="co"># Create a matrix of 10^6 observations in R^100</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="va">d</span><span class="op">)</span>,<span class="va">n</span>,<span class="va">d</span><span class="op">)</span></span>
<span><span class="co"># Second Dataset is a copy of the first with points shifted an infinitesimal</span></span>
<span><span class="co"># amount</span></span>
<span><span class="va">X_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">X</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="va">d</span>, <span class="fl">0</span>,<span class="fl">.0001</span><span class="op">)</span>, <span class="va">n</span>,<span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span></code></pre></div>
<p>I now want to join these two datasets together. The Euclidean joins
take 3 hyperparameters: <code>n_bands</code>, <code>band_width</code>,
and <code>r</code>. Which all have to be chosen for the problem domain
(although the defaults are generally sensible).</p>
<p>I use the <code>euclidean_probability</code> function in the package
to understand the probability that two observations at distance of .01
from each other are indentified as a match at a variety of
hyperparameter configurations.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/euclidean_probability.html">euclidean_probability</a></span><span class="op">(</span><span class="fl">.01</span>, n_bands <span class="op">=</span> <span class="fl">5</span>,band_width <span class="op">=</span> <span class="fl">8</span>,r <span class="op">=</span> <span class="fl">.25</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.9993764</span></span>
<span><span class="fu"><a href="../reference/euclidean_probability.html">euclidean_probability</a></span><span class="op">(</span><span class="fl">.1</span>, n_bands <span class="op">=</span> <span class="fl">5</span>,band_width <span class="op">=</span> <span class="fl">8</span>,r <span class="op">=</span> <span class="fl">.25</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.2141322</span></span>
<span></span>
<span><span class="fu"><a href="../reference/euclidean_probability.html">euclidean_probability</a></span><span class="op">(</span><span class="fl">.01</span>, n_bands <span class="op">=</span> <span class="fl">10</span>,band_width <span class="op">=</span> <span class="fl">4</span>,r <span class="op">=</span> <span class="fl">.15</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.9999999</span></span>
<span><span class="fu"><a href="../reference/euclidean_probability.html">euclidean_probability</a></span><span class="op">(</span><span class="fl">.1</span>, n_bands <span class="op">=</span> <span class="fl">10</span>,band_width <span class="op">=</span> <span class="fl">4</span>,r <span class="op">=</span> <span class="fl">.15</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.4956251</span></span>
<span></span>
<span><span class="fu"><a href="../reference/euclidean_probability.html">euclidean_probability</a></span><span class="op">(</span><span class="fl">.01</span>, n_bands <span class="op">=</span> <span class="fl">40</span>,band_width <span class="op">=</span> <span class="fl">8</span>,r <span class="op">=</span> <span class="fl">.15</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="fu"><a href="../reference/euclidean_probability.html">euclidean_probability</a></span><span class="op">(</span><span class="fl">.1</span>, n_bands <span class="op">=</span> <span class="fl">40</span>,band_width <span class="op">=</span> <span class="fl">8</span>,r <span class="op">=</span> <span class="fl">.15</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.16091</span></span></code></pre></div>
<p>Using <code>n_bands=40</code>, <code>band_width=8</code>, and
<code>r=.15</code> seems to provide a good balance between identifying
all true matches (as pairs less than .01 apart are guaranteed to be
found) with reducing the number of un-promising comparisons (as pairs
greater than .1 apart are unlikely to be compared). I then use the
<code>euclidean_inner_join</code> to find all matching pairs across the
two datasets:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">joined_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/euclidean_inner_join.html">euclidean_inner_join</a></span><span class="op">(</span></span>
<span>                     <span class="va">X</span>,</span>
<span>                     <span class="va">X_2</span>,</span>
<span>                     threshold <span class="op">=</span> <span class="fl">.01</span>,</span>
<span>                     n_bands <span class="op">=</span> <span class="fl">40</span>,</span>
<span>                     band_width <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                     r<span class="op">=</span><span class="fl">.15</span><span class="op">)</span></span>
<span><span class="va">n_matches</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">joined_out</span><span class="op">)</span></span>
<span><span class="va">time_taken</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">start</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"found"</span>, <span class="va">n_matches</span>, <span class="st">"matches in"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">time_taken</span><span class="op">)</span>, <span class="st">"seconds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "found 100000 matches in 46 seconds"</span></span></code></pre></div>
<p>Zoomerjoin is able to easily find all pairs in just under 30s
(perhaps longer on the runner that renders the website), even though the
points lie in high-dimensional (d=100) space. This makes zoomerjoin a
useful tool when trying to join or find matches between datasets of word
or document embeddings.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Beniamino Green.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
